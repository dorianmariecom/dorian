# frozen_string_literal: true

require "spec_helper"
require "json"

RSpec.describe "Dorian" do
  it "works" do
    version = File.read("VERSION")
    expect(`bin/dorian -v 2>&1`).to eq(version)
    expect(`bin/dorian --version 2>&1`).to eq(version)
    expect(`bin/dorian -h 2>&1`).to include("USAGE")
    expect(`bin/dorian --help 2>&1`).to include("USAGE")
    books_pretty =
      JSON.pretty_generate(JSON.parse(File.read("samples/books.json"))) +
      "\n"
    expect(`bin/dorian samples/books.json`).to eq(books_pretty)
    expect(`bin/dorian --pretty true samples/books.json`).to eq(books_pretty)
    expect(`bin/dorian --pretty samples/books.json`).to eq(books_pretty)
    books_ugly = JSON.parse(File.read("samples/books.json")).to_json + "\n"
    expect(`bin/dorian --pretty false samples/books.json`).to eq(books_ugly)
  end
end
